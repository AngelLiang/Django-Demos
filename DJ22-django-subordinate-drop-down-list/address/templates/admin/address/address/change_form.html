{% extends 'admin/change_form.html' %}
{% load i18n admin_urls static admin_modify %}

{% block admin_change_form_document_ready %}

    {{ block.super }}


    {% comment %} <script type="text/javascript">
        (function($) {
            $(document).ready(function() {
                $("#id_province").empty();
            })
        })
    </script> {% endcomment %}


    <script type="text/javascript">
        (function($) {
            $(function() {
                var select = $("#id_country");  // parent
                adjustProvinceDropdown()
                select.change(adjustProvinceDropdown);
            });

            function adjustProvinceDropdown() {
                var parentVal = $('#id_country').val();
                var target = $('#id_province');

                if (parentVal.length == 0) {
                    target.attr("disabled", true);
                    // 清空已禁用的下拉列表并清除从属下拉列表
                    $(target).empty();
                    target.append("<option value>---------</option>");
                }
                else {
                    target.attr("disabled", false);
                    var url = "/admin/address/country/" + parentVal + "/provinces/"; // 能够正确的访问到view的url
                    // console.log(url);
                    $.get(
                        url,
                        function(data) {
                            target.empty(); // 先清空
                            target.append("<option value>---------</option>");
                            data.forEach(function(e) {
                                target.append("<option value='"+e.id+"'>" + e.name + "</option>");
                                target.eq(0).attr('selected', 'true');  // 选中第一个
                            });
                        }
                    )
                }
            } // adjustProvinceDropdown

        })(django.jQuery);
    </script>
    
{% endblock %}
